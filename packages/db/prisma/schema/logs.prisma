enum LogLevel {
  debug
  info
  warn
  error
}

enum AIProvider {
  gemini
  openai
  kling
}

model ReelLog {
  id        String   @id @default(uuid())
  reelId    String
  reel      Reel     @relation(fields: [reelId], references: [id], onDelete: Cascade)

  level     LogLevel
  stage     String   // "scrape", "download", "analyze", "generate"
  message   String
  metadata  Json?    // дополнительные данные
  duration  Int?     // время выполнения в ms

  createdAt DateTime @default(now())

  @@index([reelId])
  @@index([stage])
  @@index([createdAt])
}

model AILog {
  id           String     @id @default(uuid())
  reelId       String?
  generationId String?

  provider     AIProvider
  operation    String     // analyzeVideo, generateOptions, generateVideo, pollStatus
  model        String?    // gemini-2.0-flash, gpt-4o, kling-video

  status       String     // pending, success, error
  error        String?

  startedAt    DateTime
  completedAt  DateTime?
  duration     Int?       // ms

  inputTokens  Int?
  outputTokens Int?
  inputMeta    Json?      // { promptLength, framesCount, videoSize }
  outputMeta   Json?      // { elementsCount, optionsCount }

  createdAt    DateTime   @default(now())

  @@index([provider])
  @@index([reelId])
  @@index([createdAt])
  @@index([status])
}

// Job Health Tracking - отслеживание здоровья job'ов для выявления зависаний
model JobHealthLog {
  id                 String    @id @default(uuid())

  // Job identification
  queueName          String    // "reel-pipeline", "video-generation", etc.
  jobId              String    // BullMQ job ID
  entityId           String?   // reelId, generationId, etc.
  entityType         String?   // "reel", "generation", "scene", "composite"

  // Health status
  status             String    // "healthy", "slow", "stalled", "recovered", "failed"
  substage           String?   // детальный этап внутри stage

  // Timing
  startedAt          DateTime
  lastActivityAt     DateTime
  completedAt        DateTime?

  // Thresholds
  expectedDurationMs Int?      // ожидаемое время
  actualDurationMs   Int?      // фактическое время

  // Alert info
  alertedAt          DateTime? // когда был отправлен alert
  alertMessage       String?

  metadata           Json?

  createdAt          DateTime  @default(now())

  @@index([queueName])
  @@index([jobId])
  @@index([status])
  @@index([lastActivityAt])
  @@index([entityId, entityType])
}



