enum ReelStatus {
  scraped      // только метаданные
  downloading  // видео качается
  downloaded   // видео скачано локально
  analyzing    // идёт анализ
  analyzed     // анализ готов, шаблон создан
  failed       // ошибка на любом этапе
}

model Reel {
  id           String      @id
  url          String
  videoUrl     String?
  thumbnailUrl String?
  caption      String?
  author       String?
  viewCount    Int?
  likeCount    Int?
  commentCount Int?
  hashtag      String?
  source       String      @default("reels") // "reels" or hashtag name
  duration     Int?        // Длительность видео в секундах

  // Pipeline status
  status       ReelStatus  @default(scraped)
  localPath    String?     // путь к скачанному файлу (fallback если S3 не настроен)
  s3Key        String?     // ключ файла в S3/MinIO
  errorMessage String?     // сообщение об ошибке если status = failed

  // Progress tracking (для анализа и скачивания)
  progress        Int       @default(0)  // 0-100%
  progressStage   String    @default("") // "uploading" | "processing" | "analyzing" | "creating_template"
  progressMessage String    @default("") // Человекочитаемое сообщение
  lastActivityAt  DateTime? // Время последней активности

  scrapedAt    DateTime    @default(now())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // Relations
  template     Template?
  logs         ReelLog[]

  @@index([hashtag])
  @@index([likeCount])
  @@index([scrapedAt])
  @@index([status])
}

model ScrapeJob {
  id             String   @id @default(uuid())
  status         String   @default("pending") // pending, running, completed, failed
  hashtag        String?
  sortMode       String   @default("top")
  limit          Int      @default(100)
  minLikes       Int      @default(100000)
  scanned        Int      @default(0)
  found          Int      @default(0)
  downloaded     Int      @default(0)
  error          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}



